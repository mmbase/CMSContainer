<?xml version="1.0" encoding="UTF-8"?>
<project xmlns:j="jelly:core" xmlns:ant="jelly:ant"
	xmlns:util="jelly:util" xmlns:artifact="artifact"
	xmlns:maven="jelly:maven">

	<postGoal name="war:webapp">
		<attainGoal name="mmbase-module:obtain-modules" />

      <ant:delete dir="${maven.mmbasemodule.webapp.dir}/mmbase/edit/wizard/xinha" />
      <j:forEach var="lib" items="${pom.artifacts}">
         <j:set var="dep" value="${lib.dependency}"/>     
         <j:if test="${dep.type == 'war'}">
             <ant:unjar src="${lib.path}" dest="${maven.mmbasemodule.webapp.dir}/${mmbase.templates.path}" overwrite="false"/>
         </j:if>
         <!--If the maven-module-plugin add a exclude attribute at the next version, we can exclude the xinha by setting the attribute, the following  code  will be removed-->
         <j:if test="${dep.type == 'mmbase-module' and dep.artifactId == 'cmsc-richtext'}">
             <j:set var="build.temp.templates" value="${maven.mmbasemodule.build.dir}/temp/templates"/>
             <ant:mkdir dir="${build.temp.templates}"/>
             <ant:unjar src="${lib.path}" dest="${build.temp.templates}">
                <patternset>
                   <include name="${maven.mmbasemodule.templates.dir}/**" />
                </patternset>
             </ant:unjar>
             <util:available file="${build.temp.templates}/${maven.mmbasemodule.templates.dir}">
             <ant:move todir="${maven.mmbasemodule.webapp.dir}/${mmbase.templates.path}" 
                      overwrite="true" preservelastmodified="true" includeEmptyDirs="no">
              <ant:fileset dir="${build.temp.templates}/${maven.mmbasemodule.templates.dir}"/>
             </ant:move>
          
             <ant:delete dir="${build.temp.templates}/${maven.mmbasemodule.templates.dir}" />  
             </util:available>
             <ant:delete dir="${build.temp.templates}" />
         </j:if>
       </j:forEach>
	</postGoal>
	<preGoal name="war:war">
		<attainGoal name="mmbase-module:install-builders" />
	</preGoal>
</project>