Migration document:

Part: core
From version: 1.6
To version: 1.7


Execute the following steps below in the given order:

Name: Add a sendtime column in <prefix>_newsletterpublication table
Goal: Used to save/get sendtime,CMSC-1348
Type: sql-script
--- Start script ---
ALTER TABLE mm_newsletterpublication ADD sendtime datetime;
ALTER TABLE live_newsletterpublication ADD sendtime datetime;
--- End script ---
*
*
*

Name: Add google analytics id
Goal: Have a google analytics id per site
ype:  sql-script
--- Start script ---
ALTER TABLE mm_site ADD COLUMN googleanalyticsid VARCHAR(40) NULL;
ALTER TABLE live_site ADD COLUMN googleanalyticsid VARCHAR(40) NULL;
--- End script ---
*
*
*

Name: Add "Click to page" option to the RelatedContentPortlet
Goal: CMSC-1167 Add "Click to page" option to the RelatedContentPortlet
ype:  sql-script
--- Start script ---
update mm_portletparameter set m_key="relatedWindow" where m_key="window" and number in (select pararel.dnumber from mm_portlet portlet, mm_parameterrel pararel, mm_portletdefinition def, mm_definitionrel defrel where def.definition="relatedcontentportlet" and def.number=defrel.dnumber and defrel.snumber=portlet.number and portlet.number=pararel.snumber);
update live_portletparameter set m_key="relatedWindow" where m_key="window" and number in (select pararel.dnumber from live_portlet portlet, live_parameterrel pararel, live_portletdefinition def, live_definitionrel defrel where def.definition="relatedcontentportlet" and def.number=defrel.dnumber and defrel.snumber=portlet.number and portlet.number=pararel.snumber);
--- End script ---
*
*
*


Name: Upgrade MMBase in customer project / implementation
Goal: Upgrade MMBase
Type: do it yourself
--- Start script ---
New:
mmbase.version=1.8.7-20090603
--- End script ---
*
*
*

Name: Migration from page/rssfeed/pagealias to navigationitem table
Goal:  Migrate all page/rssfeed/pagealias to new navigationitem table ,CMSC-1036 Introduce supertype NavigationItem
Type:  sql-script
--- Start script ---
* First start CMSC 1.6 for the first time (it needs to create the navigationitem tables!)
* Execute the following script on database:
INSERT INTO mm_navigationitem select number, otype, owner, creationdate, lastmodifieddate,publishdate,expiredate,lastmodifier,use_expirydate,urlfragment,title,description,inmenu,secure from mm_page;
INSERT INTO mm_navigationitem select number, otype, owner, creationdate, lastmodifieddate,publishdate,expiredate,lastmodifier,use_expirydate,urlfragment,title,description,inmenu,secure from mm_rssfeed;
INSERT INTO mm_navigationitem select number, otype, owner, creationdate, lastmodifieddate,publishdate,expiredate,lastmodifier,use_expirydate,urlfragment,title,description,inmenu,secure from mm_pagealias;

INSERT INTO live_navigationitem select number, otype, owner, creationdate, lastmodifieddate,publishdate,expiredate,lastmodifier,use_expirydate,urlfragment,title,description,inmenu,secure from live_page;
INSERT INTO live_navigationitem select number, otype, owner, creationdate, lastmodifieddate,publishdate,expiredate,lastmodifier,use_expirydate,urlfragment,title,description,inmenu,secure from live_rssfeed;
INSERT INTO live_navigationitem select number, otype, owner, creationdate, lastmodifieddate,publishdate,expiredate,lastmodifier,use_expirydate,urlfragment,title,description,inmenu,secure from live_pagealias;
--- End script ---